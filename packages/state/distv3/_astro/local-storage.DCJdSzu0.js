import{s as n}from"./index.BSHcnaqT.js";const a="__m";class h{constructor(t){this.data={},this.storage=t}getTable(t){if(this.storage){if(this.data[t]===void 0)try{const e=this.storage.getItem(t);this.data[t]=e?JSON.parse(e):void 0}catch{console.error("[legend-state] ObservablePersistLocalStorage failed to parse",t)}return this.data[t]}}getMetadata(t){return this.getTable(t+a)}set(t,e){this.data[t]||(this.data[t]={});for(let s=0;s<e.length;s++){const{path:i,valueAtPath:d,pathTypes:o}=e[s];this.data[t]=n(this.data[t],i,o,d)}this.save(t)}setMetadata(t,e){return this.setValue(t+a,e)}deleteTable(t){this.storage&&(delete this.data[t],this.storage.removeItem(t))}deleteMetadata(t){this.deleteTable(t+a)}setValue(t,e){this.data[t]=e,this.save(t)}save(t){if(!this.storage)return;const e=this.data[t];e!=null?this.storage.setItem(t,JSON.stringify(e)):this.storage.removeItem(t)}}class f extends h{constructor(){super(typeof localStorage<"u"?localStorage:void 0)}}export{f as O};
